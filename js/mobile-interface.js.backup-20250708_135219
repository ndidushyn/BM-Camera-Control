// Mobile Interface Controller
class MobileInterface {
    constructor() {
        this.currentTab = 'light';
        this.isConnected = false;
        this.isRecording = false;
        this.recordingStartTime = null;
        this.recordingInterval = null;
        this.cameraController = null;
        
        this.init();
    } 
                                         error.message.includes('fetch') ||
                                         error.message.includes('ERR_')
                                     ));
            
            if (isCertificateError && window.location.protocol === 'https:') {
                // –ü–æ–∫–∞–∑—É—î–º–æ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω—É –¥–æ–ø–æ–º–æ–≥—É –¥–ª—è —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—ñ–≤
                this.showCertificateErrorHelp(cameraName, error.message);
            } else if (isMixedContentError) {
                // –ü–æ–∫–∞–∑—É—î–º–æ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑ —Ä—ñ—à–µ–Ω–Ω—è–º–∏
                this.showMixedContentHelp(cameraName);
            } else {
                this.showToast(`–ù–µ –≤–¥–∞–ª–æ—Å—è –ø—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—è –¥–æ "${cameraName}": ${error.message}`, 'error');
            }     this.recordingStartTime = null;
        this.recordingInterval = null;
        this.cameraController = null;
        
        this.init();
    }
    
    init() {
        console.log('üîß Initializing Mobile Interface');
        
        // Initialize camera controller
        this.initCameraController();
        
        // Setup navigation
        this.setupNavigation();
        
        // Setup connection controls
        this.setupConnectionControls();
        
        // Setup camera controls
        this.setupCameraControls();
        
        // Setup recording controls
        this.setupRecordingControls();
        
        // Setup haptic feedback
        this.setupHapticFeedback();
        
        // Setup desktop mode button
        this.setupDesktopModeButton();
        
        // Apply initial states
        this.updateConnectionStatus();
        
        console.log('‚úÖ Mobile Interface initialized');
    }
    
    // Initialize camera controller
    initCameraController() {
        console.log('üîß Available classes:', {
            CameraController: !!window.CameraController,
            BlackmagicCameraController: !!window.BlackmagicCameraController
        });
        
        if (window.BlackmagicCameraController) {
            this.cameraController = new BlackmagicCameraController();
            console.log('‚úÖ BlackmagicCameraController initialized');
            
            // Listen to connection events
            document.addEventListener('cameraConnected', () => {
                this.isConnected = true;
                this.updateConnectionStatus();
                this.showToast('–ö–∞–º–µ—Ä–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–∞', 'success');
            });
            
            document.addEventListener('cameraDisconnected', () => {
                this.isConnected = false;
                this.updateConnectionStatus();
                this.showToast('–ö–∞–º–µ—Ä–∞ –≤—ñ–¥–∫–ª—é—á–µ–Ω–∞', 'info');
            });
            
            document.addEventListener('cameraError', (event) => {
                this.showToast(`–ü–æ–º–∏–ª–∫–∞: ${event.detail.message}`, 'error');
            });
        }
    }
    
    // Setup bottom navigation
    setupNavigation() {
        const navItems = document.querySelectorAll('.nav-item');
        
        navItems.forEach(item => {
            item.addEventListener('click', (e) => {
                const tabName = item.dataset.tab;
                this.switchTab(tabName);
                this.hapticFeedback();
            });
        });
    }
    
    // Switch between tabs
    switchTab(tabName) {
        // Hide all tabs
        document.querySelectorAll('.mobile-tab').forEach(tab => {
            tab.classList.remove('active');
        });
        
        // Remove active from nav items
        document.querySelectorAll('.nav-item').forEach(item => {
            item.classList.remove('active');
        });
        
        // Show selected tab
        const targetTab = document.getElementById(`${tabName}-tab`);
        const targetNav = document.querySelector(`[data-tab="${tabName}"]`);
        
        if (targetTab && targetNav) {
            targetTab.classList.add('active');
            targetNav.classList.add('active');
            this.currentTab = tabName;
            
            console.log(`üì± Switched to ${tabName} tab`);
        }
    }
    
    // Setup connection controls
    setupConnectionControls() {
        const connectionBtn = document.getElementById('connection-toggle');
        const disconnectBtn = document.getElementById('disconnect-btn');
        const certHelpBtn = document.getElementById('cert-help-btn');
        
        connectionBtn?.addEventListener('click', () => {
            if (this.isConnected) {
                this.disconnect();
            } else {
                this.connect();
            }
            this.hapticFeedback();
        });
        
        disconnectBtn?.addEventListener('click', () => {
            this.disconnect();
            this.hapticFeedback();
        });
        
        // Certificate help button
        certHelpBtn?.addEventListener('click', () => {
            const cameraNameInput = document.getElementById('camera-name');
            const cameraName = cameraNameInput?.value.trim() || 'camera1';
            this.openCertificateHelper(cameraName);
            this.hapticFeedback();
        });
    }
    
    // Connect to camera
    async connect() {
        const connectionBtn = document.getElementById('connection-toggle');
        const cameraNameInput = document.getElementById('camera-name');
        const cameraName = cameraNameInput?.value.trim();
        
        if (!cameraName) {
            this.showToast('–í–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É –∫–∞–º–µ—Ä–∏', 'warning');
            cameraNameInput?.focus();
            return;
        }
        
        try {
            connectionBtn.classList.add('connecting');
            connectionBtn.querySelector('.connection-text').textContent = '–ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è...';
            
            if (this.cameraController) {
                await this.cameraController.connect(cameraName);
            } else {
                throw new Error('Camera controller –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π. –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ –∫–∞–º–µ—Ä–∞ –≤ –º–µ—Ä–µ–∂—ñ.');
            }
            
        } catch (error) {
            console.error('Connection failed:', error);
            
            // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ —Ü–µ –ø–æ–º–∏–ª–∫–∞ Mixed Content –∞–±–æ HTTPS –∫–æ–Ω—Ñ–ª—ñ–∫—Ç
            const isMixedContentError = error.message.includes('Mixed Content') || 
                                      error.message.includes('insecure resource') ||
                                      error.message.includes('HTTPS/HTTP –ö–æ–Ω—Ñ–ª—ñ–∫—Ç') ||
                                      error.message.includes('blocked') ||
                                      (window.location.protocol === 'https:' && (
                                          error.message.includes('network') || 
                                          error.message.includes('fetch')
                                      ));
            
            if (isMixedContentError) {
                // –ü–æ–∫–∞–∑—É—î–º–æ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑ —Ä—ñ—à–µ–Ω–Ω—è–º–∏
                this.showMixedContentHelp(cameraName);
            } else {
                this.showToast(`–ù–µ –≤–¥–∞–ª–æ—Å—è –ø—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—è –¥–æ "${cameraName}": ${error.message}`, 'error');
            }
            
            connectionBtn.classList.remove('connecting');
            connectionBtn.querySelector('.connection-text').textContent = '–ü—ñ–¥–∫–ª—é—á–∏—Ç–∏';
        }
    }
    
    // Disconnect from camera
    async disconnect() {
        try {
            if (this.cameraController) {
                await this.cameraController.disconnect();
            } else {
                this.isConnected = false;
                this.updateConnectionStatus();
            }
        } catch (error) {
            console.error('Disconnect failed:', error);
            this.showToast('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—ñ', 'error');
        }
    }
    
    // Update connection status UI
    updateConnectionStatus() {
        const connectionBtn = document.getElementById('connection-toggle');
        const connectionStatus = document.getElementById('connection-status');
        const statusIndicator = connectionStatus?.querySelector('.status-indicator');
        const statusText = connectionStatus?.querySelector('.status-text');
        const disconnectBtn = document.getElementById('disconnect-btn');
        const connectionForm = document.querySelector('.connection-form');
        const cameraNameInput = document.getElementById('camera-name');
        
        if (this.isConnected) {
            connectionBtn.classList.remove('connecting');
            connectionBtn.classList.add('connected');
            connectionBtn.querySelector('.connection-text').textContent = '–ü—ñ–¥–∫–ª—é—á–µ–Ω–æ';
            connectionBtn.querySelector('.connection-icon').textContent = 'üìπ';
            
            // Show compact status, keep form visible but update button
            connectionStatus?.classList.remove('hidden');
            statusIndicator?.classList.add('connected');
            
            const cameraName = cameraNameInput?.value || 'camera1';
            if (statusText) statusText.textContent = `–ü—ñ–¥–∫–ª—é—á–µ–Ω–æ: ${cameraName}`;
            disconnectBtn?.classList.remove('hidden');
            
        } else {
            connectionBtn.classList.remove('connecting', 'connected');
            connectionBtn.querySelector('.connection-text').textContent = '–ü—ñ–¥–∫–ª—é—á–∏—Ç–∏';
            connectionBtn.querySelector('.connection-icon').textContent = 'üì∑';
            
            // Hide status
            connectionStatus?.classList.add('hidden');
            statusIndicator?.classList.remove('connected');
            if (statusText) statusText.textContent = '–ö–∞–º–µ—Ä–∞ –≤—ñ–¥–∫–ª—é—á–µ–Ω–∞';
            disconnectBtn?.classList.add('hidden');
        }
    }
    
    // Setup camera controls
    setupCameraControls() {
        // Gain control
        this.setupSliderControl('gain', -12, 36, 'dB', (value) => {
            this.sendCameraCommand('gain', value);
        });
        
        // Iris control
        this.setupSliderControl('iris', 140, 2048, '', (value) => {
            const fStop = this.irisToFStop(value);
            document.getElementById('iris-value').textContent = `f/${fStop}`;
            this.sendCameraCommand('iris', value);
        });
        
        // WB Temperature control
        this.setupSliderControl('wb-temp', 2500, 10000, 'K', (value) => {
            this.sendCameraCommand('whiteBalance', value);
        });
        
        // Tint control
        this.setupSliderControl('tint', -50, 50, '', (value) => {
            this.sendCameraCommand('tint', value);
        });
        
        // Focus control
        this.setupSliderControl('focus', 0, 100, '%', (value) => {
            this.sendCameraCommand('focus', value / 100);
        });
        
        // Zoom control
        this.setupSliderControl('zoom', 100, 1600, 'x', (value) => {
            document.getElementById('zoom-value').textContent = `${(value / 100).toFixed(1)}x`;
            this.sendCameraCommand('zoom', value / 100);
        });
        
        // Shutter control
        this.setupSliderControl('shutter', 24, 2000, '', (value) => {
            document.getElementById('shutter-value').textContent = `1/${value}`;
            this.sendCameraCommand('shutter', 1 / value);
        });
        
        // Shutter angle control
        this.setupSliderControl('shutter-angle', 45, 360, '¬∞', (value) => {
            this.sendCameraCommand('shutterAngle', value);
        });
        
        // Setup preset buttons
        this.setupPresetButtons();
        
        // Setup focus buttons
        this.setupFocusButtons();
        
        // Setup format buttons
        this.setupFormatButtons();
        
        // Setup recording presets
        this.setupRecordingPresets();
    }
    
    // Setup recording presets
    setupRecordingPresets() {
        document.querySelectorAll('[data-preset]').forEach(btn => {
            btn.addEventListener('click', () => {
                const preset = btn.dataset.preset;
                this.applyRecordingPreset(preset);
                this.updateActivePreset(btn, '.recording-preset');
                this.hapticFeedback();
            });
        });
        
        // Shutter angle presets
        document.querySelectorAll('[data-shutter-angle]').forEach(btn => {
            btn.addEventListener('click', () => {
                const angle = parseInt(btn.dataset.shutterAngle);
                document.getElementById('shutter-angle-slider').value = angle;
                document.getElementById('shutter-angle-value').textContent = `${angle}¬∞`;
                this.sendCameraCommand('shutterAngle', angle);
                this.hapticFeedback();
            });
        });
    }
    
    // Apply recording preset
    applyRecordingPreset(preset) {
        const presets = {
            'interview': { format: '1080p', fps: 25, codec: 'h264' },
            'documentary': { format: '4k', fps: 24, codec: 'prores' },
            'event': { format: '1080p', fps: 50, codec: 'h264' },
            'cinematic': { format: '4k', fps: 24, codec: 'blackmagic' },
            'sports': { format: '1080p', fps: 60, codec: 'h264' },
            'slow-motion': { format: '1080p', fps: 120, codec: 'h264' }
        };
        
        const settings = presets[preset];
        if (settings) {
            document.getElementById('record-format').value = settings.format;
            document.getElementById('record-fps').value = settings.fps;
            document.getElementById('record-codec').value = settings.codec;
            
            this.sendCameraCommand('recordingFormat', settings.format);
            this.sendCameraCommand('recordingFPS', settings.fps);
            this.sendCameraCommand('recordingCodec', settings.codec);
            
            this.showToast(`–ó–∞—Å—Ç–æ—Å–æ–≤–∞–Ω–æ: ${preset}`, 'success');
        }
    }
    
    // Setup slider control
    setupSliderControl(name, min, max, unit, callback) {
        const slider = document.getElementById(`${name}-slider`);
        const valueDisplay = document.getElementById(`${name}-value`);
        
        if (!slider || !valueDisplay) return;
        
        // Update slider progress visual
        const updateSliderProgress = (value) => {
            const percent = ((value - min) / (max - min)) * 100;
            slider.style.setProperty('--slider-progress', percent + '%');
        };
        
        slider.addEventListener('input', (e) => {
            const value = parseFloat(e.target.value);
            let displayValue = value;
            
            // Special formatting for different controls
            if (name === 'iris') {
                const fStop = this.irisToFStop(value);
                displayValue = `f/${fStop}`;
            } else if (name === 'zoom') {
                displayValue = `${(value / 100).toFixed(1)}x`;
            } else if (name === 'shutter') {
                displayValue = `1/${value}`;
            } else {
                displayValue = `${value}${unit}`;
            }
            
            valueDisplay.textContent = displayValue;
            valueDisplay.classList.add('updated');
            
            // Update progress indicator
            updateSliderProgress(value);
            
            setTimeout(() => {
                valueDisplay.classList.remove('updated');
            }, 600);
            
            callback(value);
            this.hapticFeedback('light');
        });
        
        // Initialize progress
        updateSliderProgress(parseFloat(slider.value));
    }
    
    // Convert iris value to f-stop
    irisToFStop(value) {
        const fStop = Math.pow(2, (value - 140) / 140);
        return fStop.toFixed(1);
    }
    
    // Setup preset buttons
    setupPresetButtons() {
        // Gain presets
        document.querySelectorAll('[data-gain]').forEach(btn => {
            btn.addEventListener('click', () => {
                const gain = parseInt(btn.dataset.gain);
                document.getElementById('gain-slider').value = gain;
                document.getElementById('gain-value').textContent = `${gain} dB`;
                this.sendCameraCommand('gain', gain);
                this.hapticFeedback();
            });
        });
        
        // Iris presets
        document.querySelectorAll('[data-iris]').forEach(btn => {
            btn.addEventListener('click', () => {
                const iris = parseInt(btn.dataset.iris);
                document.getElementById('iris-slider').value = iris;
                const fStop = this.irisToFStop(iris);
                document.getElementById('iris-value').textContent = `f/${fStop}`;
                this.sendCameraCommand('iris', iris);
                this.hapticFeedback();
            });
        });
        
        // WB Temperature presets
        document.querySelectorAll('[data-temp]').forEach(btn => {
            btn.addEventListener('click', () => {
                const temp = parseInt(btn.dataset.temp);
                document.getElementById('wb-temp-slider').value = temp;
                document.getElementById('wb-temp-value').textContent = `${temp}K`;
                this.sendCameraCommand('whiteBalance', temp);
                this.updateActivePreset(btn, '.wb-preset');
                this.hapticFeedback();
            });
        });
        
        // Shutter presets
        document.querySelectorAll('[data-shutter]').forEach(btn => {
            btn.addEventListener('click', () => {
                const shutter = parseInt(btn.dataset.shutter);
                document.getElementById('shutter-slider').value = shutter;
                document.getElementById('shutter-value').textContent = `1/${shutter}`;
                this.sendCameraCommand('shutter', 1 / shutter);
                this.hapticFeedback();
            });
        });
        
        // Tint presets
        document.querySelectorAll('[data-tint]').forEach(btn => {
            btn.addEventListener('click', () => {
                const tint = parseInt(btn.dataset.tint);
                document.getElementById('tint-slider').value = tint;
                document.getElementById('tint-value').textContent = tint;
                this.sendCameraCommand('tint', tint);
                this.updateActivePreset(btn, '.tint-presets .preset-btn');
                this.hapticFeedback();
            });
        });
        
        // Zoom presets
        document.querySelectorAll('[data-zoom]').forEach(btn => {
            btn.addEventListener('click', () => {
                const zoom = parseInt(btn.dataset.zoom);
                document.getElementById('zoom-slider').value = zoom;
                document.getElementById('zoom-value').textContent = `${(zoom / 100).toFixed(1)}x`;
                this.sendCameraCommand('zoom', zoom / 100);
                this.updateActivePreset(btn, '.zoom-presets .preset-btn');
                this.hapticFeedback();
            });
        });
    }
    
    // Setup focus buttons
    setupFocusButtons() {
        document.getElementById('focus-near')?.addEventListener('click', () => {
            this.sendCameraCommand('focusNear');
            this.hapticFeedback();
        });
        
        document.getElementById('autofocus')?.addEventListener('click', () => {
            this.sendCameraCommand('autofocus');
            this.hapticFeedback();
        });
        
        document.getElementById('focus-far')?.addEventListener('click', () => {
            this.sendCameraCommand('focusFar');
            this.hapticFeedback();
        });
    }
    
    // Setup format buttons
    setupFormatButtons() {
        document.querySelectorAll('[data-format]').forEach(btn => {
            btn.addEventListener('click', () => {
                const format = btn.dataset.format;
                this.sendCameraCommand('format', format);
                this.updateActivePreset(btn, '.format-btn');
                this.hapticFeedback();
            });
        });
        
        document.querySelectorAll('[data-fps]').forEach(btn => {
            btn.addEventListener('click', () => {
                const fps = parseInt(btn.dataset.fps);
                this.sendCameraCommand('frameRate', fps);
                this.updateActivePreset(btn, '.framerate-btn');
                this.hapticFeedback();
            });
        });
        
        document.querySelectorAll('[data-codec]').forEach(btn => {
            btn.addEventListener('click', () => {
                const codec = btn.dataset.codec;
                this.sendCameraCommand('codec', codec);
                this.updateActivePreset(btn, '.codec-btn');
                this.hapticFeedback();
            });
        });
    }
    
    // Setup recording controls
    setupRecordingControls() {
        const recordBtn = document.getElementById('record-btn');
        
        recordBtn?.addEventListener('click', () => {
            if (this.isRecording) {
                this.stopRecording();
            } else {
                this.startRecording();
            }
            this.hapticFeedback('heavy');
        });
    }
    
    // Start recording
    startRecording() {
        if (!this.isConnected) {
            this.showToast('–ü—ñ–¥–∫–ª—é—á—ñ—Ç—å –∫–∞–º–µ—Ä—É –¥–ª—è –∑–∞–ø–∏—Å—É', 'warning');
            return;
        }
        
        this.isRecording = true;
        this.recordingStartTime = Date.now();
        
        const recordBtn = document.getElementById('record-btn');
        const recordingIndicator = document.querySelector('.recording-indicator');
        
        recordBtn.classList.add('recording');
        recordBtn.querySelector('.record-text').textContent = '–°—Ç–æ–ø';
        recordBtn.querySelector('.record-icon').textContent = '‚èπ';
        
        recordingIndicator?.classList.add('active');
        
        // Start recording timer
        this.recordingInterval = setInterval(() => {
            this.updateRecordingTime();
        }, 1000);
        
        this.sendCameraCommand('startRecording');
        this.showToast('–ó–∞–ø–∏—Å —Ä–æ–∑–ø–æ—á–∞—Ç–æ', 'success');
        
        console.log('üî¥ Recording started');
    }
    
    // Stop recording
    stopRecording() {
        this.isRecording = false;
        this.recordingStartTime = null;
        
        const recordBtn = document.getElementById('record-btn');
        const recordingIndicator = document.querySelector('.recording-indicator');
        
        recordBtn.classList.remove('recording');
        recordBtn.querySelector('.record-text').textContent = '–°—Ç–∞—Ä—Ç';
        recordBtn.querySelector('.record-icon').textContent = '‚è∫';
        
        recordingIndicator?.classList.remove('active');
        
        // Stop recording timer
        if (this.recordingInterval) {
            clearInterval(this.recordingInterval);
            this.recordingInterval = null;
        }
        
        // Reset timer display
        document.querySelector('.recording-time').textContent = '00:00:00';
        
        this.sendCameraCommand('stopRecording');
        this.showToast('–ó–∞–ø–∏—Å –∑—É–ø–∏–Ω–µ–Ω–æ', 'info');
        
        console.log('‚èπ Recording stopped');
    }
    
    // Update recording time display
    updateRecordingTime() {
        if (!this.recordingStartTime) return;
        
        const elapsed = Date.now() - this.recordingStartTime;
        const seconds = Math.floor(elapsed / 1000) % 60;
        const minutes = Math.floor(elapsed / 60000) % 60;
        const hours = Math.floor(elapsed / 3600000);
        
        const timeString = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        
        document.querySelector('.recording-time').textContent = timeString;
    }
    
    // Update active preset button
    updateActivePreset(activeBtn, selector) {
        document.querySelectorAll(selector).forEach(btn => {
            btn.classList.remove('active');
        });
        activeBtn.classList.add('active');
    }
    
    // Send camera command
    sendCameraCommand(command, value = null) {
        if (!this.isConnected) {
            this.showToast('–ö–∞–º–µ—Ä–∞ –Ω–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–∞', 'warning');
            return;
        }
        
        if (this.cameraController) {
            this.cameraController.sendCommand(command, value);
        } else {
            console.log(`üì∑ Camera command: ${command}${value !== null ? ` = ${value}` : ''}`);
        }
    }
    
    // Setup haptic feedback
    setupHapticFeedback() {
        // Check if haptic feedback is supported
        this.hapticSupported = 'vibrate' in navigator;
        
        if (this.hapticSupported) {
            console.log('üì≥ Haptic feedback supported');
        }
    }
    
    // Trigger haptic feedback
    hapticFeedback(type = 'light') {
        if (!this.hapticSupported) return;
        
        const patterns = {
            light: [10],
            medium: [15],
            heavy: [25],
            success: [10, 50, 10],
            error: [50, 50, 50]
        };
        
        navigator.vibrate(patterns[type] || patterns.light);
    }
    
    // Show toast notification
    showToast(message, type = 'info', duration = 3000) {
        const toastContainer = document.getElementById('toast-container');
        if (!toastContainer) return;
        
        const toast = document.createElement('div');
        toast.className = `toast toast-${type}`;
        toast.innerHTML = `
            <span class="toast-message">${message}</span>
            <button class="toast-close">√ó</button>
        `;
        
        toastContainer.appendChild(toast);
        
        // Auto remove after specified duration
        setTimeout(() => {
            toast.remove();
        }, duration);
        
        // Close button
        toast.querySelector('.toast-close').addEventListener('click', () => {
            toast.remove();
        });
        
        // Haptic feedback for notifications
        if (type === 'error') {
            this.hapticFeedback('error');
        } else if (type === 'success') {
            this.hapticFeedback('success');
        }
        
        console.log(`üçû Toast: ${message} (${type})`);
    }
    
    // Show detailed help for Mixed Content issues
    showMixedContentHelp(cameraName) {
        const isGitHubPages = window.location.hostname.includes('github.io');
        
        if (isGitHubPages) {
            // –ü–æ–∫–∞–∑—É—î–º–æ –º–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –∑ –¥–µ—Ç–∞–ª—å–Ω–∏–º–∏ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è–º–∏
            this.showMixedContentModal(cameraName);
        } else {
            this.showToast(`üîí –ü–æ–º–∏–ª–∫–∞ HTTPS/HTTP: –°–ø—Ä–æ–±—É–π—Ç–µ –¥–æ–∑–≤–æ–ª–∏—Ç–∏ Mixed Content –≤ –±—Ä–∞—É–∑–µ—Ä—ñ`, 'warning', 8000);
        }
    }

    // Show modal with Mixed Content solutions
    showMixedContentModal(cameraName) {
        // –°—Ç–≤–æ—Ä—é—î–º–æ –º–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ
        const modal = document.createElement('div');
        modal.className = 'mixed-content-modal';
        modal.innerHTML = `
            <div class="modal-overlay">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>üîí –ü—Ä–æ–±–ª–µ–º–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è</h3>
                        <button class="modal-close">√ó</button>
                    </div>
                    <div class="modal-body">
                        <p><strong>–ù–µ –≤–¥–∞–ª–æ—Å—è –ø—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—è –¥–æ "${cameraName}"</strong></p>
                        <p>–ú–æ–∂–ª–∏–≤—ñ –ø—Ä–∏—á–∏–Ω–∏: Mixed Content –±–ª–æ–∫—É–≤–∞–Ω–Ω—è –∞–±–æ –Ω–µ–¥–æ–≤—ñ—Ä–µ–Ω–∏–π HTTPS —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç</p>
                        
                        <h4>üí° –†—ñ—à–µ–Ω–Ω—è:</h4>
                        <div class="solutions">
                            <div class="solution priority">
                                <strong>üéØ 1. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è HTTPS —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—É</strong>
                                <p>–Ø–∫—â–æ –∫–∞–º–µ—Ä–∞ –º–∞—î HTTPS —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç, –ø–æ—Ç—Ä—ñ–±–Ω–æ –¥–æ–≤—ñ—Ä–∏—Ç–∏—Å—å –π–æ–º—É:</p>
                                <button class="cert-btn" onclick="window.mobileInterface.openCertificateHelper('${cameraName}')">
                                    üîê –í—ñ–¥–∫—Ä–∏—Ç–∏ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç –∫–∞–º–µ—Ä–∏
                                </button>
                                <small>–ü—ñ—Å–ª—è –ø—Ä–∏–π–Ω—è—Ç—Ç—è —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—É –ø–æ–≤–µ—Ä–Ω—ñ—Ç—å—Å—è —ñ —Å–ø—Ä–æ–±—É–π—Ç–µ –∑–Ω–æ–≤—É</small>
                            </div>
                            
                            <div class="solution">
                                <strong>2. –õ–æ–∫–∞–ª—å–Ω–∞ –≤–µ—Ä—Å—ñ—è (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ)</strong>
                                <p>–ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ —Ç–∞ –∑–∞–ø—É—Å—Ç—ñ—Ç—å –¥–æ–¥–∞—Ç–æ–∫ –ª–æ–∫–∞–ª—å–Ω–æ:</p>
                                <a href="https://github.com/ndidushyn/BM-Camera-Control/archive/refs/heads/main.zip" 
                                   class="download-btn" target="_blank">
                                   üì• –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ ZIP
                                </a>
                                <small>–†–æ–∑–ø–∞–∫—É–π—Ç–µ —Ç–∞ –≤—ñ–¥–∫—Ä–∏–π—Ç–µ mobile.html</small>
                            </div>
                            
                            <div class="solution">
                                <strong>3. –î–æ–∑–≤–æ–ª–∏—Ç–∏ Mixed Content</strong>
                                <p>–í –∞–¥—Ä–µ—Å–Ω–æ–º—É —Ä—è–¥–∫—É –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å –Ω–∞ —ñ–∫–æ–Ω–∫—É –∑–∞–º–∫–∞ ‚Üí "–î–æ–∑–≤–æ–ª–∏—Ç–∏ –Ω–µ–∑–∞—Ö–∏—â–µ–Ω–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç"</p>
                            </div>
                            
                            <div class="solution">
                                <strong>4. HTTP –≤–µ—Ä—Å—ñ—è</strong>
                                <p>–°–ø—Ä–æ–±—É–π—Ç–µ HTTP –≤–µ—Ä—Å—ñ—é (—è–∫—â–æ –¥–æ—Å—Ç—É–ø–Ω–∞):</p>
                                <button class="http-btn" onclick="window.location.href='http://ndidushyn.github.io/BM-Camera-Control/mobile.html'">
                                    üåê –í—ñ–¥–∫—Ä–∏—Ç–∏ HTTP –≤–µ—Ä—Å—ñ—é
                                </button>
                            </div>
                        </div>
                        
                        <div class="help-note">
                            <p><strong>üìã –ü–æ–∫—Ä–æ–∫–æ–≤—ñ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó –¥–ª—è HTTPS:</strong></p>
                            <ol>
                                <li>–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫—É "–í—ñ–¥–∫—Ä–∏—Ç–∏ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç –∫–∞–º–µ—Ä–∏"</li>
                                <li>–£ –Ω–æ–≤—ñ–π –≤–∫–ª–∞–¥—Ü—ñ –ø–æ–±–∞—á–∏—Ç–µ –ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è –ø—Ä–æ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç</li>
                                <li>–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "–î–æ–¥–∞—Ç–∫–æ–≤–æ" –∞–±–æ "Advanced"</li>
                                <li>–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "–ü—Ä–æ–¥–æ–≤–∂–∏—Ç–∏ –Ω–∞ [–∞–¥—Ä–µ—Å–∞ –∫–∞–º–µ—Ä–∏]" –∞–±–æ "Proceed"</li>
                                <li>–ü–æ–≤–µ—Ä–Ω—ñ—Ç—å—Å—è —Å—é–¥–∏ —ñ —Å–ø—Ä–æ–±—É–π—Ç–µ –ø—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—è –∑–Ω–æ–≤—É</li>
                            </ol>
                        </div>
                    </div>
                </div>
            </div>
        `;
        
        document.body.appendChild(modal);
        
        // –ó–∞–∫—Ä–∏—Ç—Ç—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞
        const closeBtn = modal.querySelector('.modal-close');
        const overlay = modal.querySelector('.modal-overlay');
        
        const closeModal = () => {
            modal.remove();
        };
        
        closeBtn.addEventListener('click', closeModal);
        overlay.addEventListener('click', (e) => {
            if (e.target === overlay) {
                closeModal();
            }
        });
        
        // –ó–∞–∫—Ä–∏—Ç—Ç—è –ø–æ ESC
        const handleEscape = (e) => {
            if (e.key === 'Escape') {
                closeModal();
                document.removeEventListener('keydown', handleEscape);
            }
        };
        
        document.addEventListener('keydown', handleEscape);
    }

    // Open certificate helper for HTTPS trust
    openCertificateHelper(cameraName) {
        if (!this.cameraController) {
            this.showToast('‚ùå Camera controller –Ω–µ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π', 'error');
            return;
        }
        
        // –û—Ç—Ä–∏–º—É—î–º–æ –∞–¥—Ä–µ—Å—É –∫–∞–º–µ—Ä–∏ –∑ –ø–æ–ª—è –≤–≤–æ–¥—É
        const addressInput = document.getElementById('camera-name'); // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ camera-name ID
        const cameraAddress = addressInput ? addressInput.value.trim() : cameraName;
        
        if (!cameraAddress) {
            this.showToast('‚ùå –í–≤–µ–¥—ñ—Ç—å IP –∞–¥—Ä–µ—Å—É –∞–±–æ –Ω–∞–∑–≤—É –∫–∞–º–µ—Ä–∏', 'error');
            return;
        }
        
        // –í–∏–∫–ª–∏–∫–∞—î–º–æ —Ñ—É–Ω–∫—Ü—ñ—é –∑ camera controller
        this.cameraController.openCertificateTab(cameraAddress);
        
        // –ü–æ–∫–∞–∑—É—î–º–æ –¥–æ–¥–∞—Ç–∫–æ–≤—ñ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó
        this.showToast('üîó –í—ñ–¥–∫—Ä–∏—Ç–∞ –≤–∫–ª–∞–¥–∫–∞ –∑ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–æ–º. –ü—Ä–∏–π–º—ñ—Ç—å —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç —ñ –ø–æ–≤–µ—Ä–Ω—ñ—Ç—å—Å—è', 'info', 8000);
    }
    
    // Show enhanced certificate help
    showCertificateHelp(cameraAddress) {
        const isHTTPS = window.location.protocol === 'https:';
        
        if (isHTTPS) {
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤—ñ–¥–∫—Ä–∏–≤–∞—î–º–æ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç
            if (this.cameraController) {
                this.cameraController.openCertificateTab(cameraAddress);
            }
            
            // –ü–æ–∫–∞–∑—É—î–º–æ –¥–µ—Ç–∞–ª—å–Ω–∏–π toast –∑ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è–º–∏
            this.showToast(`
üîê –í—ñ–¥–∫—Ä–∏—Ç–∞ –≤–∫–ª–∞–¥–∫–∞ –∑ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–æ–º –∫–∞–º–µ—Ä–∏
üìã –ö—Ä–æ–∫–∏:
1. –ü—Ä–∏–π–º—ñ—Ç—å —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç —É –Ω–æ–≤—ñ–π –≤–∫–ª–∞–¥—Ü—ñ
2. –ü–æ–≤–µ—Ä–Ω—ñ—Ç—å—Å—è —Å—é–¥–∏
3. –°–ø—Ä–æ–±—É–π—Ç–µ –ø—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—è –∑–Ω–æ–≤—É
            `.trim(), 'info', 10000);
        } else {
            this.showToast('üí° HTTPS —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç –ø–æ—Ç—Ä—ñ–±–µ–Ω —Ç—ñ–ª—å–∫–∏ –ø—Ä–∏ HTTPS –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—ñ', 'info', 5000);
        }
    }
}

// Initialize mobile interface when DOM is loaded
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => {
        window.mobileInterface = new MobileInterface();
    });
} else {
    window.mobileInterface = new MobileInterface();
}
